import{R as b,S as D,y as I,E as O}from"./D-d7HeIt.js";import{f as N,E as W,G as y,s as F,H as j,r as Q,I as z,J as H,K as J,L as M}from"./BI0F1cZy.js";import{S as B}from"./DyCfErH6.js";function $(r){const s=r.split("/");return s.includes("v2")||s.includes("preview")}function te(r,s){}function oe(r,s){var g,w;if(!((g=Object.keys(s??{}))!=null&&g.length))return r;const h=new URL(r);return(w=Object.keys(s))==null||w.forEach(S=>{h.searchParams.append(S,s[S])}),h==null?void 0:h.href}const re=()=>{const r=N(),s=b(),h=D(),{$bus:g}=I();function w(){return window.location.search}function S(e){e&&(e=e.replace("tel:",""),window.location.href="tel://"+e)}function k(e){e&&(e=e.replace("sms:",""),window.location.href="sms://"+e)}function E(e){e&&(e=e.replace("mailto:",""),window.location.href="mailto:"+e)}function x(e,n){const t=`_mf_${e}`,o=JSON.stringify(n),a=O(t,{path:"/",maxAge:31536e3});a.value=o,W(t,o)}function L(e){const{extra:n}=e;r.value.videoExistsInPage&&g.$emit("handle-redirect"),n.action.value==="go-to-next-funnel-step"?f():n.action.value==="url"&&m(n.visitWebsite.value)}function f(e,n=!1,t){r.value.videoExistsInPage&&g.$emit("handle-redirect");try{const o=s.path.split("/"),a=r.value.funnelSteps||[],l=e?y({funnelSteps:a,stepId:e}):y({funnelSteps:a,funnelNextStep:r.value.funnelNextStep});let i=l==null?void 0:l.url;(o.includes("v2")||o.includes("preview"))&&(i=l?`/v2/preview/${l.id}`:""),t&&(i+=`/product/${t}`);const c=r.value.funnelDomain;if(window.location.hostname!=="localhost"&&!(o.includes("v2")||o.includes("preview"))&&c!==window.location.hostname){const u=`https://${c}${i}`+w();m({url:u,newTab:n})}else{if(n){const u=h.resolve({path:i});window.open(u.href+w(),"_blank");return}window.location.href=i+w();return}}catch(o){console.error(o)}}function m({url:e,newTab:n}){r.value.videoExistsInPage&&g.$emit("handle-redirect"),e=F(e);let t=r.value.locationId;const o=j(t);o&&(e=Q(e,o)),n?window.open(e,"_blank")===null&&(window.location.href=e):window.location.href=e}const p=(e,n=!0,t)=>{try{const o=s.path.split("/"),a=r.value.funnelSteps||[],l=s.query,i=y({funnelSteps:a,stepId:e});if(i&&!i.id)return"#";if(o.includes("v2")||o.includes("preview")){let v="";return i&&(v=`/v2/preview/${i.id}`),t&&(v+=`/product/${t}`),v}let c=i==null?void 0:i.url;delete l.domain,delete l.page_url,delete l.additional_route,delete l.step_id,delete l.funnel_id,delete l.page_id;const u=r.value.funnelDomain;t&&(c+=`/product/${t}`);const d=new URL(c,`https://${u}`);return n&&Object.keys(l).forEach(v=>{d.searchParams.append(v,l[v])}),z({url:d.href})}catch{return"#"}},R=(e,n,t)=>{if(w()){e==null||e.preventDefault();const a=p(n,!0);t?window.open(a,"_blank")===null&&(window.location.href=a):window.location.href=a}},A=()=>{var n;const e=(n=r.value.funnelSteps)==null?void 0:n.find(t=>(t==null?void 0:t.key)==="store-product-list");e&&f(e==null?void 0:e.value)},T=e=>{var t;const n=(t=r.value.funnelSteps)==null?void 0:t.find(o=>(o==null?void 0:o.key)==="store-product-detail");n&&f(n==null?void 0:n.value,!1,e)},U=e=>{var t;const n=(t=r.value.funnelSteps)==null?void 0:t.find(o=>(o==null?void 0:o.key)==="store-product-detail");if(n)return p(n==null?void 0:n.value,!1,e)},C=()=>{var n;const e=(n=r.value.funnelSteps)==null?void 0:n.find(t=>(t==null?void 0:t.key)==="store-product-list");return e?$(window.location.pathname)?`${window.location.origin}/v2/preview/${e==null?void 0:e.id}`:`https://${r.value.funnelDomain}${e.url}`:""},_=e=>{var t;const n=(t=r.value.funnelSteps)==null?void 0:t.find(o=>(o==null?void 0:o.key)==="store-product-list");return!n||$(s.path)?"":`https://${r.value.funnelDomain}${n.url}/store/account/${e}`},P=e=>{var t;const n=(t=r.value.funnelSteps)==null?void 0:t.find(o=>(o==null?void 0:o.key)==="store-product-list");if(!n||$(s.path))return"";m({url:`https://${r.value.funnelDomain}${n.url}/store/account/${e}`,newTab:!1})};return{call:S,sms:k,mailTo:E,createMembershipToken:x,goToNextFunnelStep:f,openUrl:m,getNextFunnelStepURL:p,redirectOnSubmit:L,goToEcomPrdouctListPage:A,goToEcomCartPage:()=>{var n;const e=(n=r.value.funnelSteps)==null?void 0:n.find(t=>(t==null?void 0:t.key)==="store-cart");e&&f(e==null?void 0:e.value)},redirectAction:(e,n,t,o,a,l,i)=>{try{const{saleAction:c,stepPath:u,visitWebsite:d}=e;H(n.value.funnelId,t,i),J(n.value.funnelId);const v={name:o.fullName,addressLine1:o.address,city:o.city,state:o.state,zip:o.zipcode,country:o.country};if(M(n.value.funnelId,v),!c)if(n.value.funnelNextStep){f();return}else throw new Error("Redirect not handled");switch(c.value){case"url":if(d&&d.value&&d.value.url){m(d.value);break}else throw new Error("Redirect not handled");case"step-path":if(u&&u.value){f(u.value);break}else throw new Error("Redirect not handled");case"go-to-next-funnel-step":if(n.value.funnelNextStep){f();break}else throw new Error("Redirect not handled")}}catch(c){if(console.error(c),a)alert(l);else{const u=JSON.parse(localStorage.getItem("_ud")||"{}"),d=[B.sepa].includes(localStorage.getItem(`pmt_${n.value.funnelId}_${u==null?void 0:u.id}`)||"")?"We are proccessing your order with the bank. We'll confirm you order after bank's confirmation.":`Order successfully placed! 
 However, Something went wrong while displaying this webpage, please contact the seller.`;alert(d)}}},getEcomProductListPageUrl:C,goToStep:R,goToEcomCheckoutPage:()=>{var n;const e=(n=r.value.funnelSteps)==null?void 0:n.find(t=>(t==null?void 0:t.key)==="store-checkout");e&&f(e==null?void 0:e.value)},getEcomProductListPagePath:e=>{var o;const n=(o=r.value.funnelSteps)==null?void 0:o.find(a=>(a==null?void 0:a.key)==="store-product-list");if(!n)return"";let t="";return $(s.path)?t=`/v2/preview/${n==null?void 0:n.id}`:t=`https://${r.value.funnelDomain}${n.url}`,e&&(t+=`/collections/${e}`),t},goToEcomPrdouctDetailPage:T,getRedirectActionUrl:e=>{var a;const{saleAction:n,stepPath:t,visitWebsite:o}=e;if(!n)return r.value.funnelNextStep?p():"";switch(n.value){case"url":return((a=o==null?void 0:o.value)==null?void 0:a.url)??"";case"step-path":return t!=null&&t.value?p(t.value):"";case"go-to-next-funnel-step":{const l=r.value.funnelSteps||[],i=y({funnelSteps:l,funnelNextStep:r.value.funnelNextStep});return r.value.funnelNextStep&&(i!=null&&i.value)?p(i.value):""}default:return""}},getEcomProductDetailURL:U,getCustomerAccessCenterUrl:_,goToCustomerAccessCenter:P,goToCustomerAccessCenterLogin:()=>{sessionStorage.setItem("redirect",window.location.href),P("login")}}};export{oe as a,te as g,$ as i,re as u};
